
  1  package com.redhat.coolstore.service;
  2  
  3  import java.util.List;
  4  -import java.util.logging.Logger;
  5  +import org.jboss.logging.Logger;
  6  
  7  -import javax.inject.Inject;
  8  +import jakarta.inject.Inject;
  9  
 10  -import javax.persistence.criteria.CriteriaBuilder;
 11  -import javax.persistence.criteria.CriteriaQuery;
 12  -import javax.persistence.criteria.Root;
 13  +import jakarta.persistence.criteria.CriteriaBuilder;
 14  +import jakarta.persistence.criteria.CriteriaQuery;
 15  +import jakarta.persistence.criteria.Root;
 16  
 17  -import javax.ejb.Stateless;
 18  -import javax.persistence.EntityManager;
 19  -import javax.persistence.PersistenceContext;
 20  +import jakarta.ejb.Stateless;
 21  +import jakarta.persistence.EntityManager;
 22  +import jakarta.persistence.PersistenceContext;
 23  
 24  import com.redhat.coolstore.model.*;
 25  
 26  -@Stateless
 27  +@ApplicationScoped
 28  public class CatalogService {
 29  
 30      @Inject
 31      Logger log;
 32  
 33      @PersistenceContext
 34      private EntityManager em;
 35  
 36      public CatalogService() {
 37      }
 38  
 39      public List<CatalogItemEntity> getCatalogItems() {
 40          CriteriaBuilder cb = em.getCriteriaBuilder();
 41          CriteriaQuery<CatalogItemEntity> criteria = cb.createQuery(CatalogItemEntity.class);
 42          Root<CatalogItemEntity> member = criteria.from(CatalogItemEntity.class);
 43          criteria.select(member);
 44          return em.createQuery(criteria).getResultList();
 45      }
 46  
 47      public CatalogItemEntity getCatalogItemById(String itemId) {
 48          return em.find(CatalogItemEntity.class, itemId);
 49      }
 50  
 51      public void updateInventoryItems(String itemId, int deducts) {
 52          InventoryEntity inventoryEntity = getCatalogItemById(itemId).getInventory();
 53          int currentQuantity = inventoryEntity.getQuantity();
 54          inventoryEntity.setQuantity(currentQuantity-deducts);
 55          em.merge(inventoryEntity);
 56      }
 57  
 58  }
